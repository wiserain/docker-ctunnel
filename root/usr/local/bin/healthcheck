#!/bin/bash

TEST_URL="https://google.com"

if [ "${PROXY_ENABLED}" == "true" ]; then
    # checking connectivity to caddy forwardproxy at front
    if [[ -n "${PROXY_USER:-}" ]] && [[ -n "${PROXY_PASS:-}" ]]; then
        PROXY_URL="http://${PROXY_USER}:${PROXY_PASS}@127.0.0.1:${PROXY_PORT:-8008}"
    else
        PROXY_URL="http://127.0.0.1:${PROXY_PORT:-8008}"
    fi

    /usr/bin/curl --silent --fail -o /dev/null --proxy "${PROXY_URL}" "${TEST_URL}" || exit 1
elif [ "${GT_ENABLED}" == "true" ]; then
    # checking connectivity to GT
    /usr/bin/curl --silent --fail -o /dev/null --proxy http://127.0.0.1:${GT_PORT:-21000} "${TEST_URL}" || exit 1
fi

exit 0
